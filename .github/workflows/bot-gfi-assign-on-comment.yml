name: GFI Assign on /assign

on:
    issue_comment:
        types:
            - created

permissions:
    issues: write
    contents: read

jobs:
    gfi-assign:
        # Only run on issue comments (not PR comments)
        if: github.event.issue.pull_request == null

        runs-on: ubuntu-latest

        # Prevent race conditions: always wait for the first assignment request to finish processing
        concurrency:
            group: gfi-assign-${{ github.event.issue.number }}
            cancel-in-progress: false

        steps:
            - name: Harden runner
              uses: step-security/harden-runner@20cf305ff2072d973412fa9b1e3a4f227bda3c76 # v2.14.0
              with:
                  egress-policy: audit

            - name: Checkout repository
              uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

            - name: Run GFI /assign handler
              uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd #v8.0.0
              with:
                  script: |
                      const script = require('./.github/scripts/bot-gfi-assign-on-comment.js');
                      await script({ github, context });
